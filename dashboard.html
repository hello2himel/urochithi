<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Urochithi</title>
  <link href="https://fonts.googleapis.com/css2?family=Special+Elite&family=Inter:wght@400;500;600;700&family=Caveat:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/dashboard.css">

  <!-- Google reCAPTCHA v3 -->
  <script src="https://www.google.com/recaptcha/api.js?render=6LexmEAsAAAAACHpDnLBe-hy8XA9GuJd8lx0tYBc"></script>
  <!-- REPLACE ABOVE WITH YOUR ACTUAL SITE KEY -->
</head>
<body>

  <!-- Step 1: Static PIN -->
  <div id="step1Container" class="auth-container">
    <div class="auth-card">
      <div class="auth-header">
        <span class="auth-icon">ğŸ”</span>
        <h1 class="auth-title">Dashboard Login</h1>
        <p class="auth-subtitle">Enter your PIN to continue</p>
      </div>
      <form id="step1Form" class="auth-form">
        <div class="form-group">
          <label class="form-label">PIN</label>
          <input type="password" id="staticPin" class="form-input" placeholder="â€¢â€¢â€¢â€¢" autocomplete="off" required>
        </div>
        <div id="step1Error" class="auth-error"></div>
        <button type="submit" class="auth-button" id="step1Button">Continue</button>
      </form>
    </div>
  </div>

  <!-- Step 2: Time-based PIN -->
  <div id="step2Container" class="auth-container" style="display: none;">
    <div class="auth-card">
      <div class="auth-header">
        <span class="auth-icon">â°</span>
        <h1 class="auth-title">Time Verification</h1>
        <p class="auth-subtitle">Calculate and enter the time-based code</p>
      </div>
      <div class="time-display">
        <div class="time-label">Current UTC Time</div>
        <div class="time-value" id="utcTime">--:--</div>
      </div>
      <form id="step2Form" class="auth-form">
        <div class="form-group">
          <label class="form-label">Time-based Code</label>
          <input type="number" id="timePin" class="form-input" placeholder="000" autocomplete="off" required>
          <div class="time-hint">Use the formula with current UTC time shown above</div>
        </div>
        <div id="step2Error" class="auth-error"></div>
        <button type="submit" class="auth-button" id="step2Button">Authenticate</button>
      </form>
      <div class="back-link" id="backToStep1">â† Back to PIN</div>
    </div>
  </div>

  <!-- Dashboard -->
  <div id="dashboardContainer" class="dashboard-container">
    <nav class="dashboard-nav">
      <div class="nav-brand">
        <span>ğŸ“Š</span>
        <span>Dashboard</span>
      </div>
      <div class="nav-actions">
        <button class="nav-btn" id="refreshBtn"><span>â†»</span> <span>Refresh</span></button>
        <a href="/" class="nav-btn">Home</a>
        <button class="nav-btn primary" id="logoutBtn">Logout</button>
      </div>
    </nav>

    <div class="dashboard-content">
      <div class="stats-grid">
        <div class="stat-card"><div class="stat-label">Total Messages</div><div class="stat-value" id="totalMessages">0</div></div>
        <div class="stat-card"><div class="stat-label">Today</div><div class="stat-value" id="todayMessages">0</div></div>
        <div class="stat-card"><div class="stat-label">Unique Sessions</div><div class="stat-value" id="uniqueSessions">0</div></div>
        <div class="stat-card"><div class="stat-label">This Week</div><div class="stat-value" id="weekMessages">0</div></div>
      </div>

      <div class="controls-section">
        <div class="controls">
          <div class="search-wrapper">
            <span class="search-icon">ğŸ”</span>
            <input type="text" id="searchInput" class="search-input" placeholder="Search messages or session IDs...">
          </div>
          <select id="sortSelect" class="filter-select">
            <option value="newest">Newest First</option>
            <option value="oldest">Oldest First</option>
          </select>
          <select id="filterSelect" class="filter-select">
            <option value="all">All Messages</option>
            <option value="today">Today</option>
            <option value="week">This Week</option>
            <option value="month">This Month</option>
          </select>
        </div>
      </div>

      <div class="messages-wrapper">
        <div id="messagesContainer">
          <div class="loading-screen">
            <div class="spinner"></div>
            <div class="loading-text">Loading messages...</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Letter Modal -->
  <div id="letterModal" class="modal-overlay">
    <div class="letter-modal" id="letterCard">
      <div class="stain stain1"></div>
      <div class="stain stain2"></div>
      <div class="stain stain3"></div>

      <button class="close-modal" id="closeModal">Ã—</button>

      <div class="letter-header">
        <div class="letter-title">UROCHITHI</div>
        <div class="letter-subtitle">Anonymous Letter</div>
        <div class="letter-session" id="modalSessionId"></div>
      </div>

      <div class="letter-content-wrapper">
        <div class="letter-content" id="modalLetterContent"></div>
      </div>

      <div class="letter-footer" id="letterFooter">
        Send your anonymous letter at <span id="domainText">urochithi.netlify.app</span>
      </div>

      <div class="letter-actions">
        <button class="action-btn" id="copyBtn"><span>ğŸ“‹</span> <span>Copy</span></button>
        <button class="action-btn" id="saveBtn"><span>ğŸ’¾</span> <span>Save</span></button>
        <button class="action-btn" id="shareBtn"><span>ğŸ”—</span> <span>Share</span></button>
      </div>
    </div>
  </div>

  <script src="js/config.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="js/dashboard.js"></script>
</body>
</html>